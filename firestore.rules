rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
  
    // Allow any authenticated user to read and write customers and access codes.
    // This is for the admin panel.
    match /customers/{customerId} {
      allow read, write: if request.auth != null;
    }
    
    match /access_codes/{accessCodeId} {
       allow read, write: if request.auth != null;
    }
    
    // Allow anyone to read a specific access code if they are not used
    // This is for the validation on the pricing page.
    match /access_codes/{accessCodeId} {
      allow get: if resource.data.isUsed == false;
    }
    
    // Only authenticated users can read the admin roles collection (though it's not used for permission anymore)
    match /roles_admin/{userId} {
      allow read, write: if request.auth != null;
    }
  }
}
