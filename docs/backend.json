{
  "entities": {
    "Customer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Customer",
      "type": "object",
      "description": "Represents a customer who has purchased access to the Mega Millions Maximizer number generation service.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the customer.",
          "format": "uuid"
        },
        "email": {
          "type": "string",
          "description": "The customer's email address.",
          "format": "email"
        },
        "accessCodeId": {
          "type": "string",
          "description": "Reference to AccessCode. (Relationship: Customer 1:1 AccessCode)"
        }
      },
      "required": [
        "id",
        "email",
        "accessCodeId"
      ]
    },
    "AccessCode": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AccessCode",
      "type": "object",
      "description": "Represents a unique access code granted to a customer after purchase, allowing them to generate number combinations.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the access code.",
          "format": "uuid"
        },
        "code": {
          "type": "string",
          "description": "The unique access code itself."
        },
        "isUsed": {
          "type": "boolean",
          "description": "Indicates whether the access code has been used to generate numbers.",
          "format": "boolean"
        }
      },
      "required": [
        "id",
        "code",
        "isUsed"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/customers/{customerId}",
        "definition": {
          "entityName": "Customer",
          "schema": {
            "$ref": "#/backend/entities/Customer"
          },
          "description": "Stores customer information. Includes a reference to the AccessCode and the isUsed status of the code (denormalized for authorization independence).",
          "params": [
            {
              "name": "customerId",
              "description": "The unique identifier for the customer."
            }
          ]
        }
      },
      {
        "path": "/access_codes/{accessCodeId}",
        "definition": {
          "entityName": "AccessCode",
          "schema": {
            "$ref": "#/backend/entities/AccessCode"
          },
          "description": "Stores access codes.  Includes the 'code' and 'isUsed' status.",
          "params": [
            {
              "name": "accessCodeId",
              "description": "The unique identifier for the access code."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{userId}",
        "definition": {
          "entityName": "roles_admin",
          "schema": {
            "$ref": "#/backend/entities/Customer"
          },
          "description": "Documents in this collection grant admin access. Existence of a document grants admin role.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the admin user."
            }
          ]
        }
      }
    ],
    "reasoning": "This Firestore data structure is designed to securely manage customer access codes for the Mega Millions Maximizer service. It uses structural segregation and denormalization to ensure authorization independence, enabling robust security rules without relying on hierarchical `get()` calls. The design separates admin roles from customer data, stores access codes in their own collection, and denormalizes the `isUsed` field from the `AccessCode` document into the `Customer` document to avoid needing `get()` calls to the `AccessCode` document on every number generation request.\n\nThe structure achieves Authorization Independence by avoiding hierarchical dependencies. Specifically, the customer document stores the access code ID and the isUsed status to avoid `get()` calls to access codes for basic customer operations. This supports atomic operations (transactions/batches) and enhances debuggability.\n\nTo support QAPs (Rules are not Filters), access codes are stored in their own collection. This means that list operations on customer data do not require filtering based on access code attributes. Admin users can be managed by creating documents in `/roles_admin/{uid}`."
  }
}